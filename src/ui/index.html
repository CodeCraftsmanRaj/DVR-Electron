<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';"
    />
    <title>DVR-Scan</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>DVR-Scan</h1>

      <div class="tabs">
        <button
          class="tab-button active"
          data-for-panel="motion-detection-panel"
        >
          Motion Detection
        </button>
        <button class="tab-button" data-for-panel="hikvision-panel">
          Hikvision Forensics
        </button>
        <!-- New Tab Button -->
        <button class="tab-button" data-for-panel="explorer-panel">
          Forensic Explorer
        </button>
      </div>

      <!-- MOTION DETECTION (SCAN) PANEL (No changes here) -->
      <div id="motion-detection-panel" class="panel active">
        <fieldset>
          <legend>Input Videos</legend>
          <div class="file-controls">
            <button id="choose-files-button" class="button">
              Choose Files
            </button>
            <button id="remove-button" disabled>Clear Selection</button>
          </div>
          <div id="video-list-container"></div>
        </fieldset>
        <fieldset>
          <legend>Scan Settings</legend>
          <div class="settings-grid">
            <div>
              <label for="threshold">Threshold:</label>
              <input
                type="number"
                id="threshold"
                value="0.15"
                step="0.01"
                min="0"
              />
            </div>
            <div>
              <label for="min-event-length">Min Event Length (s):</label>
              <input type="text" id="min-event-length" value="0.1s" />
            </div>
            <div>
              <label for="output-mode">Output Mode:</label>
              <select id="output-mode">
                <option value="opencv">OpenCV (.avi)</option>
                <option value="ffmpeg">ffmpeg (re-encode)</option>
                <option value="copy">ffmpeg (copy)</option>
              </select>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend>Advanced Settings</legend>
          <div class="advanced-settings-grid">
            <div class="checkbox-group vertical">
              <label>Overlays:</label>
              <div>
                <input type="checkbox" id="bounding-box" /><label
                  for="bounding-box"
                  >Draw bounding box</label
                >
              </div>
              <div>
                <input type="checkbox" id="time-code" /><label for="time-code"
                  >Draw timecode</label
                >
              </div>
              <div>
                <input type="checkbox" id="frame-metrics" /><label
                  for="frame-metrics"
                  >Draw frame metrics</label
                >
              </div>
            </div>
            <div class="input-group vertical">
              <label>Performance:</label>
              <div>
                <label for="frame-skip">Frame Skip:</label
                ><input type="number" id="frame-skip" value="0" min="0" />
              </div>
              <div>
                <label for="downscale-factor">Downscale Factor:</label
                ><input type="number" id="downscale-factor" value="1" min="1" />
              </div>
            </div>
            <div class="input-group vertical full-width">
              <label for="region-data">Region of Interest Data:</label>
              <textarea
                id="region-data"
                rows="4"
                placeholder="Paste region data here... e.g.: 100 100 800 100 800 600 100 600"
              ></textarea>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend>Run</legend>
          <button id="start-scan-button">Start Scan</button>
          <div class="checkbox-group">
            <input type="checkbox" id="scan-only" />
            <label for="scan-only">Scan Only (no output files)</label>
          </div>
        </fieldset>
      </div>

      <!-- HIKVISION FORENSICS PANEL (No changes here) -->
      <div id="hikvision-panel" class="panel hidden">
        <fieldset>
          <legend>Step 1: Select Inputs & Output Directory</legend>
          <div class="hik-grid">
            <label>Disk Image File:</label>
            <div class="file-input-group">
              <button id="hik-choose-image-button" class="button">
                Choose Image (.dd, .E01)...
              </button>
              <span id="hik-image-display">No file selected</span>
            </div>
            <label>Output Directory:</label>
            <div class="file-input-group">
              <button id="hik-choose-output-button" class="button">
                Choose Directory...
              </button>
              <span id="hik-output-display">No directory selected</span>
            </div>
          </div>
        </fieldset>
        <fieldset id="hik-step2-fieldset" disabled>
          <legend>Step 2: Parse Filesystem & Logs</legend>
          <button id="hik-parse-all-button">
            Parse Master Sector, HIKBTREE, and System Logs
          </button>
          <div class="parse-status">
            <p>
              Master Sector:
              <span id="master-status" class="status-pending">Pending...</span>
            </p>
            <p>
              HIKBTREE:
              <span id="hikbtree-status" class="status-pending"
                >Pending...</span
              >
            </p>
            <p>
              System Logs:
              <span id="logs-status" class="status-pending">Pending...</span>
            </p>
          </div>
        </fieldset>
        <fieldset id="hik-step3-fieldset" disabled>
          <legend>Step 3: Extract Video Block</legend>
          <div class="hik-grid">
            <label>Block Offset (Hex):</label>
            <input
              type="text"
              id="hik-offset-input"
              placeholder="e.g., 0xfc4c5e000"
            />
            <button id="hik-extract-button">Extract Video</button>
            <span></span>
            <!-- Empty cell for alignment -->
          </div>
        </fieldset>
      </div>

      <!-- New Forensic Explorer Panel -->
      <div id="explorer-panel" class="panel hidden">
        <fieldset>
          <legend>Data Explorer Controls</legend>
          <div class="hik-grid">
            <label>Output Directory:</label>
            <span id="explorer-output-display"
              >No directory selected. Please run Step 1 on the Hikvision
              Forensics tab first.</span
            >
            <span></span>
            <button id="load-explorer-data-button" disabled>
              Load / Refresh Forensic Data
            </button>
          </div>
        </fieldset>
        <fieldset>
          <legend>Video Recordings</legend>
          <div id="explorer-table-container">
            <p>
              No data loaded. Click the "Load" button above after parsing the
              image.
            </p>
          </div>
        </fieldset>
      </div>

      <!-- Progress & Output Section (Shared for all panels) -->
      <fieldset>
        <legend>Progress & Output</legend>
        <div id="progress-container" class="hidden">
          <p id="progress-text">Waiting for task...</p>
          <progress id="progress-bar" value="0" max="100"></progress>
        </div>
        <pre id="output-area"></pre>
      </fieldset>
    </div>

    <script src="renderer.js"></script>
  </body>
</html>
